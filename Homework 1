import requests
import functools
import tracemalloc




def fetch_url(url, first_n=10):
    """Fetch a given url"""
    res = requests.get(url)
    return res.content[:first_n] if first_n else res.content

def to_cache(f,limit_cache=5,cache = []):
    
    @functools.wraps(f)
    def inner(*args,**kwargs):
            count = []
            dict_cache = dict()
            if len(cache) < limit_cache:
                cache.append(f(*args,**kwargs))
                
            else:
                for i in cache:
                    i = cache.count(i)
                    count.append(i)
                cache.pop(count.index(min(count)))
                count.remove(min(count))
                cache.append(f(*args,**kwargs))
            for i in cache:
                if str(cache.count(i)) not in dict_cache.keys():
                    dict_cache[str(cache.count(i))] = [i]
                else:
                    dict_cache[str(cache.count(i))] += [i]
                lst_for_sort = []
                result = dict()
                final = []
                
                for i in dict_cache.keys():
                    i = int(i)
                    lst_for_sort.append(i)
                lst_for_sort.sort()
                lst_for_sort = [str(i) for i in lst_for_sort]
                for i in lst_for_sort:
                    result[i] = dict_cache[i]
                for i in result.values():
                    for y in i:
                        final.append(y)
                
            return final
    return inner

def memory_used(f):
    def inner(*args,**kwargs):
        tracemalloc.start()
        f(*args,**kwargs)
        result =tracemalloc.get_traced_memory()[0]
        tracemalloc.stop()
        
        return str(round(result/1000,2)) + ' megabytes used'
    return inner   
  


put_to_cache = to_cache(fetch_url,limit_cache=7)
memory_check = memory_used(to_cache(fetch_url))

put_to_cache('http://youtube.com')
put_to_cache('http://ithillel.ua')
put_to_cache('http://ithillel.ua')
put_to_cache('http://ithillel.ua')
put_to_cache('http://youtube.com')
put_to_cache('http://youtube.com')

print(put_to_cache('http://google.com'))

print(memory_check('http://ithillel.ua'))
print(memory_check('http://ithillel.ua'))
print(memory_check('http://google.com'))

